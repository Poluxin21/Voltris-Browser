<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
                    sans-serif;
                background: #1a1a1a;
                color: #fff;
                overflow: hidden;
            }

            /* Barra de abas */
            .tab-bar {
                display: flex;
                align-items: center;
                background: #2d2d2d;
                padding: 8px 8px 0 8px;
                gap: 2px;
                border-bottom: 1px solid #1a1a1a;
            }

            .tab {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 10px 16px;
                background: #3d3d3d;
                border-radius: 8px 8px 0 0;
                cursor: pointer;
                max-width: 240px;
                min-width: 180px;
                position: relative;
                transition: background 0.2s;
                user-select: none;
            }

            .tab:hover {
                background: #4a4a4a;
            }

            .tab.active {
                background: #1a1a1a;
            }

            .tab-favicon {
                width: 16px;
                height: 16px;
                flex-shrink: 0;
                font-size: 14px;
            }

            .tab-title {
                flex: 1;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                font-size: 13px;
                color: #e0e0e0;
            }

            .tab.active .tab-title {
                color: #fff;
            }

            .tab-close {
                width: 18px;
                height: 18px;
                border-radius: 4px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 16px;
                opacity: 0.6;
                transition: all 0.2s;
                flex-shrink: 0;
            }

            .tab-close:hover {
                background: rgba(255, 255, 255, 0.1);
                opacity: 1;
            }

            .new-tab-btn {
                width: 32px;
                height: 32px;
                border-radius: 6px;
                background: transparent;
                border: none;
                color: #e0e0e0;
                font-size: 20px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background 0.2s;
                margin-left: 4px;
            }

            .new-tab-btn:hover {
                background: rgba(255, 255, 255, 0.1);
            }

            /* Barra de navega√ß√£o */
            .nav-bar {
                display: flex;
                align-items: center;
                padding: 12px;
                background: #1a1a1a;
                gap: 8px;
            }

            .nav-btn {
                width: 36px;
                height: 36px;
                border-radius: 8px;
                background: transparent;
                border: none;
                color: #e0e0e0;
                font-size: 18px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s;
            }

            .nav-btn:hover:not(:disabled) {
                background: rgba(255, 255, 255, 0.1);
            }

            .nav-btn:disabled {
                opacity: 0.3;
                cursor: not-allowed;
            }

            .url-container {
                flex: 1;
                display: flex;
                align-items: center;
                background: #2d2d2d;
                border-radius: 12px;
                padding: 0 14px;
                height: 40px;
                transition: background 0.2s;
            }

            .url-container:focus-within {
                background: #3d3d3d;
                box-shadow: 0 0 0 2px rgba(255, 67, 54, 0.3);
            }

            .url-icon {
                color: #888;
                margin-right: 8px;
                font-size: 16px;
            }

            #urlInput {
                flex: 1;
                background: transparent;
                border: none;
                outline: none;
                color: #fff;
                font-size: 14px;
            }

            #urlInput::placeholder {
                color: #666;
            }

            .go-btn {
                background: #ff4336;
                color: white;
                border: none;
                padding: 8px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
                transition: all 0.2s;
                margin-left: 8px;
            }

            .go-btn:hover {
                background: #ff5a4d;
            }

            #status {
                font-size: 11px;
                color: #888;
                margin-left: 8px;
                min-width: 70px;
                text-align: center;
            }

            .loading {
                color: #4a90e2;
            }
            .error {
                color: #ff4336;
            }
            .ready {
                color: #4caf50;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            .loading::before {
                content: "‚ü≥ ";
                display: inline-block;
                animation: spin 1s linear infinite;
            }
        </style>
    </head>
    <body>
        <div class="tab-bar">
            <div class="tab active" data-tab-id="0">
                <span class="tab-favicon">üåê</span>
                <span class="tab-title">Nova aba</span>
                <span class="tab-close" onclick="closeTab(0, event)">√ó</span>
            </div>
            <button
                class="new-tab-btn"
                onclick="createNewTab()"
                title="Nova aba"
            >
                +
            </button>
        </div>

        <div class="nav-bar">
            <button
                class="nav-btn"
                onclick="goBack()"
                id="backBtn"
                title="Voltar"
            >
                ‚Üê
            </button>
            <button
                class="nav-btn"
                onclick="goForward()"
                id="forwardBtn"
                title="Avan√ßar"
            >
                ‚Üí
            </button>
            <button class="nav-btn" onclick="reload()" title="Recarregar">
                ‚ü≥
            </button>

            <div class="url-container">
                <span class="url-icon">üîí</span>
                <input
                    type="text"
                    id="urlInput"
                    placeholder="Pesquise ou digite um endere√ßo"
                    value="https://www.google.com"
                />
            </div>

            <button class="go-btn" onclick="navigate()">Ir</button>

            <div id="status">Pronto</div>
        </div>

        <script>
            let tabs = [
                {
                    id: 0,
                    url: "https://www.google.com",
                    title: "Google",
                    history: ["https://www.google.com"],
                    historyIndex: 0,
                },
            ];
            let activeTabId = 0;
            let nextTabId = 1;

            function getActiveTab() {
                return tabs.find((tab) => tab.id === activeTabId);
            }

            function updateTabBar() {
                const tabBar = document.querySelector(".tab-bar");
                const newTabBtn = tabBar.querySelector(".new-tab-btn");

                tabBar.querySelectorAll(".tab").forEach((tab) => tab.remove());

                tabs.forEach((tab) => {
                    const tabEl = document.createElement("div");
                    tabEl.className =
                        "tab" + (tab.id === activeTabId ? " active" : "");
                    tabEl.dataset.tabId = tab.id;
                    tabEl.onclick = (e) => {
                        if (!e.target.classList.contains("tab-close")) {
                            switchTab(tab.id);
                        }
                    };

                    tabEl.innerHTML = `
                    <span class="tab-favicon">üåê</span>
                    <span class="tab-title">${tab.title}</span>
                    <span class="tab-close" onclick="closeTab(${tab.id}, event)">√ó</span>
                `;

                    tabBar.insertBefore(tabEl, newTabBtn);
                });
            }

            function createNewTab() {
                const newTab = {
                    id: nextTabId++,
                    url: "https://google.com",
                    title: "Nova aba",
                    history: ["https://google.com"],
                    historyIndex: 0,
                };

                tabs.push(newTab);
                switchTab(newTab.id);
            }

            function closeTab(tabId, event) {
                event.stopPropagation();

                if (tabs.length === 1) {
                    return;
                }

                const tabIndex = tabs.findIndex((tab) => tab.id === tabId);
                tabs.splice(tabIndex, 1);

                if (tabId === activeTabId) {
                    const newActiveIndex = Math.max(0, tabIndex - 1);
                    switchTab(tabs[newActiveIndex].id);
                }

                updateTabBar();
            }

            function switchTab(tabId) {
                activeTabId = tabId;
                const tab = getActiveTab();

                document.getElementById("urlInput").value = tab.url;
                updateButtons();
                updateTabBar();

                window.ipc.postMessage("navigate:" + tab.url);
            }

            function updateButtons() {
                const tab = getActiveTab();
                document.getElementById("backBtn").disabled =
                    tab.historyIndex <= 0;
                document.getElementById("forwardBtn").disabled =
                    tab.historyIndex >= tab.history.length - 1;
            }

            function normalizeUrl(input) {
                input = input.trim();

                if (!input.includes(".") || input.includes(" ")) {
                    return (
                        "https://www.google.com/search?q=" +
                        encodeURIComponent(input)
                    );
                }

                if (
                    !input.startsWith("http://") &&
                    !input.startsWith("https://")
                ) {
                    input = "https://" + input;
                }

                return input;
            }

            function updateStatus(message, className) {
                const status = document.getElementById("status");
                status.textContent = message;
                status.className = className;
            }

            function extractTitle(url) {
                try {
                    const urlObj = new URL(url);
                    return urlObj.hostname.replace("www.", "");
                } catch {
                    return "Nova aba";
                }
            }

            function navigate() {
                const tab = getActiveTab();
                const input = document.getElementById("urlInput").value;
                const url = normalizeUrl(input);

                updateStatus("Carregando...", "loading");
                document.getElementById("urlInput").value = url;

                tab.history = tab.history.slice(0, tab.historyIndex + 1);
                tab.history.push(url);
                tab.historyIndex = tab.history.length - 1;
                tab.url = url;
                tab.title = extractTitle(url);

                updateButtons();
                updateTabBar();

                window.ipc.postMessage("navigate:" + url);
            }

            function goBack() {
                const tab = getActiveTab();
                if (tab.historyIndex > 0) {
                    tab.historyIndex--;
                    tab.url = tab.history[tab.historyIndex];
                    document.getElementById("urlInput").value = tab.url;
                    updateStatus("Carregando...", "loading");
                    updateButtons();
                    window.ipc.postMessage("navigate:" + tab.url);
                }
            }

            function goForward() {
                const tab = getActiveTab();
                if (tab.historyIndex < tab.history.length - 1) {
                    tab.historyIndex++;
                    tab.url = tab.history[tab.historyIndex];
                    document.getElementById("urlInput").value = tab.url;
                    updateStatus("Carregando...", "loading");
                    updateButtons();
                    window.ipc.postMessage("navigate:" + tab.url);
                }
            }

            function reload() {
                const tab = getActiveTab();
                updateStatus("Recarregando...", "loading");
                window.ipc.postMessage("navigate:" + tab.url);
            }

            window.addEventListener("message", function (event) {
                const data = event.data;
                const tab = getActiveTab();

                if (data.type === "url_changed") {
                    tab.url = data.url;
                    document.getElementById("urlInput").value = data.url;
                    tab.title = extractTitle(data.url);
                    updateStatus("Pronto", "ready");
                    updateTabBar();
                } else if (data.type === "loading") {
                    updateStatus("Carregando...", "loading");
                } else if (data.type === "loaded") {
                    updateStatus("Pronto", "ready");
                } else if (data.type === "error") {
                    updateStatus("Erro", "error");
                }
            });

            document
                .getElementById("urlInput")
                .addEventListener("keypress", function (e) {
                    if (e.key === "Enter") {
                        navigate();
                    }
                });

            updateButtons();
        </script>
    </body>
</html>
